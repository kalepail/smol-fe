commit 556d27e0ea9c0d4f653fa55e1c2f3e5d0eb82ab3
Author: tacticalnoot <jeff@noot.xlm>
Date:   Thu Jan 15 23:27:18 2026 -0600

    refactor(auth): align passkey implementation to factory spec (simplified flows)

diff --git a/src/stores/user.svelte.ts b/src/stores/user.svelte.ts
index 4bb9b69..37aee36 100644
--- a/src/stores/user.svelte.ts
+++ b/src/stores/user.svelte.ts
@@ -84,25 +84,13 @@ export async function ensureWalletConnected(): Promise<void> {
   if (userState.contractId && userState.keyId && !userState.walletConnected) {
 
 
-    try {
-      const hostname = window.location.hostname;
-      const rpId = hostname === "localhost" ? "localhost" : (getDomain(hostname) ?? undefined);
-
-      await account.get().connectWallet({
-        rpId,
-        // keyId: userState.keyId, // REMOVED: Rely on browser discovery (Standard Flow)
-      });
-      userState.walletConnected = true;
-
-    } catch (error) {
-      console.error('[userState] Failed to connect wallet (stale?):', error);
-      // AUTO-BURN: If the saved key fails to connect, wipe it so the user isn't stuck.
-      // This solves the loop where Soft Logout keeps a bad key.
-      clearUserAuth();
-      // We do NOT throw here if we want to fail gracefully, but the caller might expect it.
-      // Since we cleared auth, the UI will revert to "Login".
-      throw error;
-    }
+    const hostname = window.location.hostname;
+    const rpId = hostname === "localhost" ? "localhost" : (getDomain(hostname) ?? undefined);
+
+    await account.get().connectWallet({
+      rpId,
+    });
+    userState.walletConnected = true;
   }
 }
 

commit ac2dc660ebbc5fe035272ed2925598ffe24329e0
Author: tacticalnoot <jeff@noot.xlm>
Date:   Thu Jan 15 23:07:44 2026 -0600

    fix(auth): align with standard passkey discovery flow (remove targeted auth)

diff --git a/src/stores/user.svelte.ts b/src/stores/user.svelte.ts
index 9aaa44c..4bb9b69 100644
--- a/src/stores/user.svelte.ts
+++ b/src/stores/user.svelte.ts
@@ -90,7 +90,7 @@ export async function ensureWalletConnected(): Promise<void> {
 
       await account.get().connectWallet({
         rpId,
-        keyId: userState.keyId,
+        // keyId: userState.keyId, // REMOVED: Rely on browser discovery (Standard Flow)
       });
       userState.walletConnected = true;
 

commit ebd44711f3fddc1f4561fb0a7d4fce1d760ee6ad
Author: tacticalnoot <jeff@noot.xlm>
Date:   Thu Jan 15 23:04:18 2026 -0600

    fix(auth): implement smart logout with auto-burn for stale keys

diff --git a/src/stores/user.svelte.ts b/src/stores/user.svelte.ts
index 264b75e..9aaa44c 100644
--- a/src/stores/user.svelte.ts
+++ b/src/stores/user.svelte.ts
@@ -68,8 +68,9 @@ export function clearUserAuth() {
   userState.walletConnected = false;
 
   if (typeof localStorage !== "undefined") {
-    localStorage.removeItem("smol:contractId");
-    localStorage.removeItem("smol:keyId");
+    // Soft Logout: We do NOT remove contractId/keyId so user can easily reconnect
+    // localStorage.removeItem("smol:contractId");
+    // localStorage.removeItem("smol:keyId");
     localStorage.removeItem("smol:skip_intro"); // Optional: reset intro
   }
 }
@@ -94,7 +95,12 @@ export async function ensureWalletConnected(): Promise<void> {
       userState.walletConnected = true;
 
     } catch (error) {
-      console.error('[userState] Failed to connect wallet:', error);
+      console.error('[userState] Failed to connect wallet (stale?):', error);
+      // AUTO-BURN: If the saved key fails to connect, wipe it so the user isn't stuck.
+      // This solves the loop where Soft Logout keeps a bad key.
+      clearUserAuth();
+      // We do NOT throw here if we want to fail gracefully, but the caller might expect it.
+      // Since we cleared auth, the UI will revert to "Login".
       throw error;
     }
   }

commit d04e25406c0800f0e8ee8f020f88257cec75eae7
Author: tacticalnoot <jeff@noot.xlm>
Date:   Thu Jan 15 23:01:33 2026 -0600

    fix(auth): revert soft logout to allow full session reset

diff --git a/src/stores/user.svelte.ts b/src/stores/user.svelte.ts
index f1750d8..264b75e 100644
--- a/src/stores/user.svelte.ts
+++ b/src/stores/user.svelte.ts
@@ -68,10 +68,9 @@ export function clearUserAuth() {
   userState.walletConnected = false;
 
   if (typeof localStorage !== "undefined") {
-    // Soft Logout: We do NOT remove contractId/keyId so user can easily reconnect
-    // localStorage.removeItem("smol:contractId");
-    // localStorage.removeItem("smol:keyId");
-    localStorage.removeItem("smol:skip_intro");
+    localStorage.removeItem("smol:contractId");
+    localStorage.removeItem("smol:keyId");
+    localStorage.removeItem("smol:skip_intro"); // Optional: reset intro
   }
 }
 

commit efc9c3302a44a82552d32286ec1335825474a299
Author: tacticalnoot <jeff@noot.xlm>
Date:   Thu Jan 15 22:58:12 2026 -0600

    fix(auth): harden authentication logic with robust key extraction and recovery flows

diff --git a/src/stores/user.svelte.ts b/src/stores/user.svelte.ts
index 2f6bcb0..f1750d8 100644
--- a/src/stores/user.svelte.ts
+++ b/src/stores/user.svelte.ts
@@ -85,11 +85,11 @@ export async function ensureWalletConnected(): Promise<void> {
 
 
     try {
-      // Use current hostname as RP ID to avoid PSL issues with pages.dev (tldts returning 'pages.dev' which is invalid)
-      // or let browser default (usually ideal).
-      // Testing with undefined to let browser allow current origin.
+      const hostname = window.location.hostname;
+      const rpId = hostname === "localhost" ? "localhost" : (getDomain(hostname) ?? undefined);
+
       await account.get().connectWallet({
-        rpId: undefined, // Let browser handle origin validation
+        rpId,
         keyId: userState.keyId,
       });
       userState.walletConnected = true;
