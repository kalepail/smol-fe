---
import Layout from '../layouts/Layout.astro';
import ArtistsIndex from '../components/artist/ArtistsIndex.svelte';
import snapshot from '../data/smols-snapshot.json';

// Aggregate artists
const artists = {};

snapshot.forEach(smol => {
    if (!smol.Address) return;
    
    if (!artists[smol.Address]) {
        artists[smol.Address] = {
            address: smol.Address,
            count: 0,
            latestSmol: smol
        };
    }
    
    // update details
    const entry = artists[smol.Address];
    entry.count++;
    
    // keep latest for cover
    if (new Date(smol.Created_At) > new Date(entry.latestSmol.Created_At)) {
        entry.latestSmol = smol;
    }
});

const sortedArtists = Object.values(artists);

if (import.meta.env.DEV) {
    console.log(`[Artists Page] Loaded snapshot items: ${snapshot.length}`);
    console.log(`[Artists Page] Unique artists found: ${sortedArtists.length}`);
}

---

<Layout title="Smol â€“ Artists">
	<main class="min-h-screen text-white p-6 pt-24 max-w-7xl mx-auto">
        <div class="flex flex-col md:flex-row md:items-end justify-between mb-12 gap-6">
            <div>
                <h1 class="text-4xl font-bold mb-2 tracking-tighter">Artists</h1>
                <p class="text-white/50 font-mono text-sm uppercase tracking-widest">Global Creator Network</p>
            </div>
        </div>
        
        <ArtistsIndex client:load initialArtists={sortedArtists} />
    </main>
</Layout>
